{% extends "./layouts/storefront-base.html" %}
{% load extras %}
{% load static %}

{% block content %}

<div class="app-content">

    <!--====== Section 1 ======-->
    <div class="u-s-p-y-60">

        <!--====== Section Content ======-->
        <div class="section__content">
            <div class="container">
                <div class="breadcrumb">
                    <div class="breadcrumb__wrap">
                        <ul class="breadcrumb__list">
                            <li class="has-separator">

                                <a href="{% url 'live-view' secret %}">Home</a>
                            </li>
                            <li class="is-marked">

                                <a href="{% url 'storefront-dashboard' secret %}">My Account</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--====== End - Section 1 ======-->


    <!--====== Section 2 ======-->
    <div class="u-s-p-b-60">

        <!--====== Section Content ======-->
        <div class="section__content">
            <div class="dash">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3 col-md-12">

                            <!--====== Dashboard Features ======-->
                            <div class="dash__box dash__box--bg-white dash__box--shadow u-s-m-b-30">
                                {% include username|get_template_path:path|add:"/includes/dashboard-sidebar-menu.html" %}
                            </div>
                            <div class="dash__box dash__box--bg-white dash__box--shadow dash__box--w">
                                <div class="dash__pad-1">
                                    <ul class="dash__w-list">
                                        <li>
                                            <div class="dash__w-wrap">

                                                <span class="dash__w-icon dash__w-icon-style-1"><i
                                                        class="fas fa-cart-arrow-down"></i></span>

                                                <span class="dash__w-text">{{orders|length}}</span>

                                                <span class="dash__w-name">Orders Placed</span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="dash__w-wrap">

                                                <span class="dash__w-icon dash__w-icon-style-2"><i
                                                        class="fas fa-times"></i></span>

                                                <span class="dash__w-text">0</span>

                                                <span class="dash__w-name">Cancel Orders</span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="dash__w-wrap">

                                                <span class="dash__w-icon dash__w-icon-style-3"><i
                                                        class="far fa-heart"></i></span>

                                                <span class="dash__w-text">0</span>

                                                <span class="dash__w-name">Wishlist</span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!--====== End - Dashboard Features ======-->
                        </div>
                        <div class="col-lg-9 col-md-12">
                            <div class="dash__box dash__box--shadow dash__box--radius dash__box--bg-white u-s-m-b-30">
                                <div class="dash__pad-2">
                                    <h1 class="dash__h1 u-s-m-b-14">Manage My Account</h1>

                                    <span class="dash__text u-s-m-b-30">From your My Account Dashboard you have the
                                        ability to view a snapshot of your recent account activity and update your
                                        account information. Select a link below to view or edit information.</span>
                                    <div class="row">
                                        <div class="col-lg-6 u-s-m-b-30">
                                            <div class="dash__box dash__box--bg-grey dash__box--shadow-2 u-h-100">
                                                <div class="dash__pad-3">
                                                    <h2 class="dash__h2 u-s-m-b-8">PERSONAL PROFILE</h2>

                                                    {% comment %} <div class="dash__link dash__link--secondary u-s-m-b-8">
                                                        <a href="dash-edit-profile.html">Edit</a>
                                                    </div>  {% endcomment %}

                                                    <span class="dash__text-2 u-s-m-b-8" >{{user.first_name}} {{user.last_name}}</span>

                                                    <span class="dash__text  u-s-m-b-8">{{user.email}}</span>

                                                    <span class="dash__text  u-s-m-b-8">+91-{{user.mobile_number}}</span>

                                                    {% comment %} <div class="dash__link dash__link--secondary u-s-m-t-8">
                                                        <a data-modal="modal" data-modal-id="#dash-newsletter">
                                                            Subscribe Newsletter
                                                        </a>
                                                    </div> {% endcomment %}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 u-s-m-b-30">
                                            <div class="dash__box dash__box--bg-grey dash__box--shadow-2 u-h-100">
                                                <div class="dash__pad-3">
                                                    <h2 class="dash__h2 u-s-m-b-8">ADDRESS BOOK</h2>

                                                    <span class="dash__text-2 u-s-m-b-8">Default Shipping Address</span>

                                                    {% comment %} <div class="dash__link dash__link--secondary u-s-m-b-8">
                                                        <a href="dash-address-book.html">Edit</a>
                                                    </div> {% endcomment %}

                                                    <span class="dash__text">
                                                        {{address.line1}} {{address.line2}} {{address.city}} -
                                                        {{address.pin}} {{address.state.name}} {{address.state.country}}
                                                    </span>

                                                    <span class="dash__text">(+0) 900901904</span>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- <div class="col-lg-4 u-s-m-b-30">
                                            <div class="dash__box dash__box--bg-grey dash__box--shadow-2 u-h-100">
                                                <div class="dash__pad-3">
                                                    <h2 class="dash__h2 u-s-m-b-8">BILLING ADDRESS</h2>

                                                    <span class="dash__text-2 u-s-m-b-8">Default Billing Address</span>

                                                    <span class="dash__text">4247 Ashford Drive Virginia - VA-20006 -
                                                        USA</span>

                                                    <span class="dash__text">(+0) 900901904</span>
                                                </div>
                                            </div>
                                        </div> -->
                                    </div>
                                </div>
                            </div>
                            <div class="dash__box dash__box--shadow dash__box--bg-white dash__box--radius">
                                <h2 class="dash__h2 u-s-p-xy-20">RECENT ORDERS</h2>
                                <div class="dash__table-wrap gl-scroll">
                                    <table class="dash__table">
                                        <thead>
                                            <tr>
                                                <th>Order Id</th>
                                                <th>Placed On</th>
                                                <th>Items</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for order in orders %}
                                            <tr>
                                                <td>{{order.order_number}}</td>
                                                <td>{{order.created_at|date:"M d, Y"  }}</td>
                                                <td>
                                                    <div class="dash__table-img-wrap" style="width:100%;height: unset;display: flex;justify-content: center;background-color: unset;">
                                                        <div style="display:flex;">
                                                            {% for orderitem in order.items.all %}
                                                                {% if forloop.counter < 3 %}
                                                                    <div class="description__img-wrap  ml-54" style="width:42px;height:42px;">
                                                                        {% if orderitem.product_variant.product.has_multiple_variants %}
                                                                            <img class="u-img-fluid"
                                                                                src="{{orderitem.product_variant.featured_image.image.url}}" alt="" style="width:100%;height:100%;object-fit:cover;min-width:unset;">
                                                                        {% else %}
                                                                            <img class="u-img-fluid" src="{{orderitem.product_variant.product.featured_image.image.url}}" alt="" style="width:100%;height:100%;object-fit:cover;min-width:unset;">
                                                                        {% endif %}
                                                                    </div>   
                                                                {% endif %}
                                                            {% endfor %}

                                                        </div>
                                                        {% if order.items.all|length > 2 %}
                                                            <div style="height:24px;width:24px;border-radius:50%;padding: 2px;display:flex;align-items:center;justify-content:center;
                                                            margin-top: -8px;" class="{{order.get_item_statuses|first}}">
                                                                <span>+{{order.items.all.count|add:"-2"}}</span>
                                                            </div>  
                                                        {% endif %}
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="dash__table-total">
                                                        <span>{{username|get_formated_price:order.total_amount}}</span>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--====== End - Section Content ======-->
    </div>
    <!--====== End - Section 2 ======-->
</div>

{% endblock content %}